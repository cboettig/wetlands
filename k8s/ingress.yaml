apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: wetlands-maplibre-ingress
  annotations:
    # Enable CORS for this Ingress
    haproxy.org/cors-enable: "true"
    
    # Allow requests from any origin
    haproxy.org/cors-allow-origin: "*"
    
    # Allow GET and OPTIONS methods
    haproxy.org/cors-allow-methods: "GET, OPTIONS"
    
    # Allow necessary headers
    haproxy.org/cors-allow-headers: "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Accept,Accept-Encoding,Accept-Language,Connection,Host,Origin,Referer,Sec-Fetch-Dest,Sec-Fetch-Mode,Sec-Fetch-Site,Priority"
    
    # Expose headers in responses
    haproxy.org/cors-expose-headers: "Content-Length,Content-Range"
    
    # Cannot use credentials with wildcard origin
    haproxy.org/cors-allow-credentials: "false"
    
    # Cache preflight responses for 1 hour
    haproxy.org/cors-max-age: "3600"
    
    # Standard timeouts for static content
    haproxy.org/timeout-http-request: "60s"
    haproxy.org/timeout-server: "60s"
    haproxy.org/timeout-client: "60s"
    haproxy.org/timeout-connect: "10s"
    
    # Return CORS headers even on error responses
    haproxy.org/error-files: "true"

spec:
  ingressClassName: haproxy
  tls:
    - hosts:
        - wetlands.nrp-nautilus.io
      # Uncomment and add secretName if managing your own certificates
      # secretName: wetlands-maplibre-tls
  rules:
    - host: wetlands.nrp-nautilus.io
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: wetlands-maplibre
                port:
                  number: 80
